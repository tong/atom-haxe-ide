(function(C){function I(a,b){function c(){}c.prototype=a;var m=new c,e;for(e in b)m[e]=b[e];b.toString!==Object.prototype.toString&&(m.toString=b.toString);return m}function v(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=N++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=function(){return c.method.apply(c.scope,arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c);return c}C.xxx=C.xxx||{};var J=function(){return r.__string_rec(this,"")},
x=function(a,b){this.r=new RegExp(a,b.split("u").join(""))};x.__name__=!0;x.prototype={match:function(a){this.r.global&&(this.r.lastIndex=0);this.r.m=this.r.exec(a);this.r.s=a;return null!=this.r.m},matched:function(a){if(null!=this.r.m&&0<=a&&a<this.r.m.length)return this.r.m[a];throw new t("EReg::matched");}};var l=function(){};l.__name__=!0;l.cca=function(a,b){var c=a.charCodeAt(b);return c!=c?void 0:c};l.substr=function(a,b,c){if(null==c)c=a.length;else if(0>c)if(0==b)c=a.length+c;else return"";
return a.substr(b,c)};Math.__name__=!0;var k=function(){};k.__name__=!0;k.string=function(a){return r.__string_rec(a,"")};k.parseInt=function(a){var b=parseInt(a,10);0!=b||120!=l.cca(a,1)&&88!=l.cca(a,1)||(b=parseInt(a));return isNaN(b)?null:b};var n=function(){};n.__name__=!0;n.isSpace=function(a,b){var c=l.cca(a,b);return 8<c&&14>c?!0:32==c};n.ltrim=function(a){for(var b=a.length,c=0;c<b&&n.isSpace(a,c);)++c;return 0<c?l.substr(a,c,b-c):a};n.rtrim=function(a){for(var b=a.length,c=0;c<b&&n.isSpace(a,
b-c-1);)++c;return 0<c?l.substr(a,0,b-c):a};n.trim=function(a){return n.ltrim(n.rtrim(a))};n.replace=function(a,b,c){return a.split(b).join(c)};var O=require("atom").CompositeDisposable,z=require("atom").Emitter,K=require("atom").File,L=require("atom").Point,P=require("atom").Range,y=function(a){var b=this;this.id=setInterval(function(){b.run()},a)};y.__name__=!0;y.delay=function(a,b){var c=new y(b);c.run=function(){c.stop();a()};return c};y.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),
this.id=null)},run:function(){}};var p=function(a){switch(a){case ".":case "..":this.dir=a;this.file="";return}var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");b<c?(this.dir=l.substr(a,0,c),a=l.substr(a,c+1,null),this.backslash=!0):c<b?(this.dir=l.substr(a,0,b),a=l.substr(a,b+1,null)):this.dir=null;b=a.lastIndexOf(".");-1!=b?(this.ext=l.substr(a,b+1,null),this.file=l.substr(a,0,b)):(this.ext=null,this.file=a)};p.__name__=!0;p.withoutExtension=function(a){a=new p(a);a.ext=null;return a.toString()};p.withoutDirectory=
function(a){a=new p(a);a.dir=null;return a.toString()};p.extension=function(a){a=new p(a);return null==a.ext?"":a.ext};p.prototype={toString:function(){return(null==this.dir?"":this.dir+(this.backslash?"\\":"/"))+this.file+(null==this.ext?"":"."+this.ext)}};var t=function(a){Error.call(this);this.val=a;this.message=String(a);Error.captureStackTrace&&Error.captureStackTrace(this,t)};t.__name__=!0;t.wrap=function(a){return a instanceof Error?a:new t(a)};t.__super__=Error;t.prototype=I(Error.prototype,
{});var r=function(){};r.__name__=!0;r.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"==c&&(a.__name__||a.__ename__)&&(c="object");switch(c){case "function":return"<function>";case "object":if(a instanceof Array){if(a.__enum__){if(2==a.length)return a[0];c=a[0]+"(";b+="\t";for(var m=2,e=a.length;m<e;)var d=m++,c=2!=d?c+(","+r.__string_rec(a[d],b)):c+r.__string_rec(a[d],b);return c+")"}c=a.length;m="[";b+="\t";for(e=0;e<c;)d=e++,m+=(0<d?",":
"")+r.__string_rec(a[d],b);return m+"]"}try{m=a.toString}catch(f){return"???"}if(null!=m&&m!=Object.toString&&"function"==typeof m&&(c=a.toString(),"[object Object]"!=c))return c;c=null;m="{\n";b+="\t";e=null!=a.hasOwnProperty;for(c in a)e&&!a.hasOwnProperty(c)||"prototype"==c||"__class__"==c||"__super__"==c||"__interfaces__"==c||"__properties__"==c||(2!=m.length&&(m+=", \n"),m+=b+c+" : "+r.__string_rec(a[c],b));b=b.substring(1);return m+("\n"+b+"}");case "string":return a;default:return String(a)}};
var Q=require("child_process"),M=require("fs"),R=require("path"),u=require("buffer").Buffer,h=function(){};h.__name__=!0;h.parse=function(a){if(h.PATTERN.match(a)){a=new h;a.path=h.PATTERN.matched(1);a.line=k.parseInt(h.PATTERN.matched(2));switch(h.PATTERN.matched(3)){case "character":a.character=k.parseInt(h.PATTERN.matched(4));a.content=h.PATTERN.matched(7);break;case "characters":a.characters={start:k.parseInt(h.PATTERN.matched(4)),end:k.parseInt(h.PATTERN.matched(6))};a.content=h.PATTERN.matched(7);
break;case "lines":a.lines={start:k.parseInt(h.PATTERN.matched(4)),end:k.parseInt(h.PATTERN.matched(6))},a.content=h.PATTERN.matched(7)}return a}return null};var D=function(a,b){null==b&&(b=!0);null==a&&(a="haxe");this.haxePath=a;this.verbose=b};D.__name__=!0;D.prototype={start:function(a){this.stop();this.buffer=new E;this.nextMessageLength=-1;this.process=Q.spawn(this.haxePath,["-v","--wait","stdio"]);this.process.on("exit",v(this,this.handleExit));this.process.stderr.on("data",v(this,this.handleData));
this.process.stdout.on("data",function(a){});this.getVersion(function(b){b=f.stringToVersion(b);b=f.lessThan(b,f.stringToVersion("3.3.0"))?"haxe >= 3.3.0 required":null;a(b)})},stop:function(){if(null!=this.process){this.process.removeAllListeners();try{this.process.kill()}catch(b){}this.process=null}for(var a=this.requestsHead;null!=a;)a.processResult(null),a=a.next;this.requestsHead=this.requestsTail=this.currentRequest=null},getVersion:function(a){this.query(["-version"],null,a,function(a){})},
query:function(a,b,c,d,e){a=new F(a,b,c,d,e);null==this.requestsHead?this.requestsHead=this.requestsTail=a:(this.requestsTail.next=a,a.prev=this.requestsTail,this.requestsTail=a);this.checkQueue()},checkQueue:function(){null==this.currentRequest&&null!=this.requestsHead&&(this.currentRequest=this.requestsHead,this.requestsHead=this.currentRequest.next,this.process.stdin.write(this.currentRequest.prepareBody()))},handleData:function(a){for(this.buffer.append(a);;){if(-1==this.nextMessageLength){a=
this.buffer.tryReadLength();if(-1==a)break;this.nextMessageLength=a}a=this.buffer.tryReadContent(this.nextMessageLength);if(null==a)break;this.nextMessageLength=-1;if(null!=this.currentRequest){var b=this.currentRequest;this.currentRequest=null;b.processResult(a);this.checkQueue()}}},handleExit:function(a,b){}};var E=function(a){null==a&&(a=8192);this.size=a;this.buffer=new u(a);this.index=0};E.__name__=!0;E.prototype={append:function(a){if(this.buffer.length-this.index>=a.length)a.copy(this.buffer,
this.index,0,a.length);else{var b=(Math.ceil((this.index+a.length)/this.size)+1)*this.size|0;0==this.index?(this.buffer=new u(b),a.copy(this.buffer,0,0,a.length)):this.buffer=u.concat([this.buffer.slice(0,this.index),a],b)}this.index+=a.length},tryReadLength:function(){if(4>this.index)return-1;var a=this.buffer.readInt32LE(0);this.buffer=this.buffer.slice(4);this.index-=4;return a},tryReadContent:function(a){if(this.index<a)return null;var b=this.buffer.toString("utf-8",0,a);this.buffer.copy(this.buffer,
0,a);this.index-=a;return b}};var F=function(a,b,c,d,e){this.args=a;this.stdin=b;this.onResult=c;this.onError=d;this.onMessage=e};F.__name__=!0;F.prototype={prepareBody:function(){null!=this.stdin&&(this.args=this.args.concat(["-D","display-stdin"]));for(var a=new u(4),b=[a],c=0,d=0,e=this.args;d<e.length;){var g=e[d];++d;g=new u(""+g+"\n");b.push(g);c+=g.length}null!=this.stdin&&(d=new u([1]),b.push(d),e=new u(this.stdin),b.push(e),c+=e.length+d.length);a.writeInt32LE(c,0);return u.concat(b,c+4)},
processResult:function(a){if(null==a)this.onResult(null);else{var b="",c=!1,d=0;for(a=a.split("\n");d<a.length;){var e=a[d];++d;switch(e.charCodeAt(0)){case 1:e=n.replace(e.substring(1),"\u0001","\n");if(null!=this.onMessage)this.onMessage(e);break;case 2:c=!0;break;default:b+=null==e?"null":""+e,b+="\n"}}b=n.trim(b);if(c)this.onError(b);else this.onResult(b)}}};var f={__name__:!0,stringToVersion:function(a){if(!f.VERSION.match(a))throw new t('Invalid SemVer format for "'+a+'"');a=k.parseInt(f.VERSION.matched(1));
var b=k.parseInt(f.VERSION.matched(2)),c=k.parseInt(f.VERSION.matched(3)),d=f.parseIdentifiers(f.VERSION.matched(4)),e=f.parseIdentifiers(f.VERSION.matched(5));return{version:[a,b,c],pre:d,build:e}},equals:function(a,b){return a.version[0]!=b.version[0]||a.version[1]!=b.version[1]||a.version[2]!=b.version[2]?!1:f.equalsIdentifiers(a.pre,b.pre)},greaterThan:function(a,b){return 0<a.pre.length&&0<b.pre.length?a.version[0]==b.version[0]&&a.version[1]==b.version[1]&&a.version[2]==b.version[2]?f.greaterThanIdentifiers(a.pre,
b.pre):!1:0<b.pre.length?a.version[0]!=b.version[0]?a.version[0]>b.version[0]:a.version[1]!=b.version[1]?a.version[1]>b.version[1]:a.version[2]!=b.version[2]?a.version[2]>b.version[2]:0<a.pre.length?f.greaterThanIdentifiers(a.pre,b.pre):!0:0>=a.pre.length?a.version[0]!=b.version[0]?a.version[0]>b.version[0]:a.version[1]!=b.version[1]?a.version[1]>b.version[1]:a.version[2]!=b.version[2]?a.version[2]>b.version[2]:f.greaterThanIdentifiers(a.pre,b.pre):!1},greaterThanOrEqual:function(a,b){return f.equals(a,
b)?!0:f.greaterThan(a,b)},lessThan:function(a,b){return!f.greaterThanOrEqual(a,b)},parseIdentifiers:function(a){return(null==a?"":a).split(".").map(f.sanitize).filter(function(a){return""!=a}).map(f.parseIdentifier)},parseIdentifier:function(a){var b=k.parseInt(a);return null==b?A.StringId(a):A.IntId(b)},equalsIdentifiers:function(a,b){if(a.length!=b.length)return!1;for(var c=0,d=a.length;c<d;){var e=c++,g=b[e],e=a[e];switch(e[1]){case 0:if(0==g[1]&&e[2]!=g[2])return!1;break;case 1:if(1==g[1]&&e[2]!=
g[2])return!1}}return!0},greaterThanIdentifiers:function(a,b){for(var c=0,d=a.length;c<d;){var e=c++,g=b[e],e=a[e];switch(e[1]){case 0:switch(g[1]){case 0:if(e[2]==g[2])continue;else return e[2]>g[2]?!0:!1;case 1:return!0;default:return!1}case 1:if(1==g[1])if(e[2]==g[2])continue;else return e[2]>g[2]?!0:!1;else return!1;default:return!1}}return!1},sanitize:function(a){return a.replace(f.SANITIZER.r,"")}},A={__ename__:!0,__constructs__:["StringId","IntId"],StringId:function(a){a=["StringId",0,a];a.__enum__=
A;a.toString=J;return a},IntId:function(a){a=["IntId",1,a];a.__enum__=A;a.toString=J;return a}},G=function(){this.excludeLowerPriority=!1;this.inclusionPriority=2;this.disableForSelector=".source.haxe .comment, .source.hx .comment";this.selector=".source.haxe, .source.hx"};G.__name__=!0;G.prototype={dispose:function(){},getSuggestions:function(a){return new Promise(function(a,c){a([])})}};var B=function(a){z.call(this);this.hxml=a};B.__name__=!0;B.__super__=z;B.prototype=I(z.prototype,{start:function(a){null==
a&&(a=!1);var b=this;this.args=["--cwd",this.hxml.getParent().getPath()];a&&this.args.push("-v");this.args.push(this.hxml.getBaseName());d.server.query(this.args,null,function(a){b.emit("end",0)},function(a){a=n.trim(a);b.emit("error",a);b.emit("end",null)},function(a){b.emit("message",a)});this.emit("start",null)}});var d=C.xxx.IDE=function(){};d.__name__=!0;d.activate=function(a){d.disposables=new O;d.emitter=new z;d.statusbar=new w;d.server=new D(atom.config.get("xxx.haxe_path"));d.projectPaths=
atom.project.getPaths();y.delay(function(){d.server.start(function(a){null!=a?atom.notifications.addWarning(a):d.disposables.add(atom.commands.add("atom-workspace","xxx:build",function(a){a=a.target.getAttribute("data-path");null!=a&&"hxml"==p.extension(a)&&null!=d.hxml&&a!=d.hxml.getPath()&&d.selectHxml(a);d.build()}))})},atom.config.get("xxx.haxe_server_startdelay"));d.searchHxmlFiles(null,null,function(b){d.hxmlFiles=b;null!=a&&null!=a.hxml?-1!=d.hxmlFiles.indexOf(a.hxml)&&d.selectHxml(a.hxml):
d.selectHxml(b[0]);d.disposables.add(atom.project.onDidChangePaths(function(a){for(var b=[],e=0;e<a.length;){var g=a[e];++e;for(var f=!0,h=0,k=d.projectPaths;h<k.length;){var l=k[h];++h;if(l==g){f=!1;break}}f&&b.push(g)}d.searchHxmlFiles(b,null,function(a){d.hxmlFiles=d.hxmlFiles.concat(a)});return d.projectPaths=a}));d.disposables.add(atom.workspace.observeTextEditors(function(a){var b=a.getPath();if(null!=b&&"hx"==p.extension(b))a.onDidChange(function(a){})}))})};d.serialize=function(){return{hxml:null!=
d.hxml?d.hxml.getPath():null}};d.deactivate=function(){d.disposables.dispose();d.server.stop()};d.onSelectHxml=function(a){return d.emitter.on("hxml_select",a)};d.onBuild=function(a){return d.emitter.on("build",a)};d.selectHxml=function(a){if(null==a)d.hxml=null;else{if(null!=d.hxml&&a==d.hxml.getPath())return;d.hxml=new K(a)}d.emitter.emit("hxml_select",d.hxml)};d.build=function(){if(null==d.hxml)return atom.notifications.addWarning("No hxml file selected"),null;var a=new B(d.hxml);new q(a);d.emitter.emit("build",
a);a.start();return a};d.searchHxmlFiles=function(a,b,c){null==b&&(b=3);null==a&&(a=atom.project.getPaths());for(var d=function(a,c,e){null==e&&(e=0);var g=[];M.readdir(a,function(f,h){var k=h.length;if(0==k)c(g);else for(var l=0;l<h.length;){var n=[h[l]];++l;var q=R.resolve(a,n[0]);n[0]=q;M.stat(n[0],function(a){return function(f,h){if(null!=h&&h.isDirectory())if(e<b){var l=a[0],n=function(){return function(a){g=g.concat(a);0==--k&&c(g)}}();d(l,n,e+1)}else 0==--k&&c(g);else"hxml"==p.extension(a[0])&&
"extraParams.hxml"!=p.withoutDirectory(a[0])&&g.push(a[0]),0==--k&&c(g)}}(n))}})},e=[],g=0,f=0;f<a.length;){var h=a[f];++f;d(h,function(b){e=e.concat(b);(g+=1)==a.length&&c(e)})}};d.getConfig=function(a){return atom.config.get("xxx."+a)};d.consumeStatusBar=function(a){a.addLeftTile({item:d.statusbar.element,priority:-100})};d.provideAutoCompletion=function(){return new G};d.provideService=function(){return{getHxml:function(){return d.hxml},selectHxml:d.selectHxml,build:d.build}};var H=function(a,
b){this.error=b;this.element=window.document.createElement("li");this.element.classList.add("message","error");var c=window.document.createElement("i");c.textContent=k.string(a+1);this.element.appendChild(c);c=window.document.createElement("span");c.classList.add("path");c.textContent=b.path;this.element.appendChild(c);c=window.document.createElement("span");c.classList.add("line");c.textContent=null==b.line?"null":""+b.line;this.element.appendChild(c);null!=b.characters&&(c=window.document.createElement("span"),
c.classList.add("start"),c.textContent=k.string(b.characters.start),this.element.appendChild(c),c=window.document.createElement("span"),c.classList.add("end"),c.textContent=k.string(b.characters.end),this.element.appendChild(c));c=window.document.createElement("span");c.classList.add("content");c.textContent=b.content;this.element.appendChild(c)};H.__name__=!0;H.prototype={select:function(){}};var q=function(a){var b=this;null!=q.current&&q.current.destroy();q.current=this;this.element=window.document.createElement("div");
this.element.classList.add("xxx-build","resizer");this.messages=window.document.createElement("ol");this.messages.classList.add("messages","scroller");this.element.appendChild(this.messages);this.panel=atom.workspace.addBottomPanel({item:this.element,visible:!0});var c=[];a.on("start",function(){c=[]});a.on("message",function(a){b.log(a)});a.on("error",function(a){for(var d=0,g=a.split("\n");d<g.length;){var f=g[d];++d;f=[h.parse(f)];if(null==f[0])b.log(a,"error");else{c.push(f[0]);var k=[new H(b.messages.children.length,
f[0])];k[0].element.onclick=function(a,b){return function(){a[0].select();q.openErrorPosition(b[0])}}(k,f);b.messages.appendChild(k[0].element)}}});a.on("end",function(d){if(0==d)0==b.messages.children.length&&b.panel.hide();else if(0<c.length)if(d=c[0],(new K(d.path,!1)).existsSync())q.openErrorPosition(d);else{var e=atom.project.relativizePath(a.hxml.getPath());d.path=e[0]+"/"+d.path}});this.element.addEventListener("click",v(this,this.handleClick),!1)};q.__name__=!0;q.openPosition=function(a,b,
c,d,e,f){null==e&&(e=!0);null==d&&(d=!0);atom.workspace.open(a,{initialLine:b,initialColumn:c,activatePane:d,searchAllPanes:e}).then(function(a){null!=f&&f(a)})};q.openErrorPosition=function(a){var b=a.line-1;q.openPosition(a.path,b,a.character,null,null,function(c){null!=a.characters&&c.setSelectedBufferRange(new P(new L(b,a.characters.start),new L(b,a.characters.end)))})};q.prototype={destroy:function(){this.panel.destroy()},log:function(a,b){a=n.trim(a);if(0!=a.length){var c=window.document.createElement("li");
c.classList.add("message");null!=b&&c.classList.add(b);c.textContent=a;this.messages.appendChild(c)}},handleClick:function(a){a.ctrlKey&&this.panel.hide()}};var w=function(){var a=this;this.element=window.document.createElement("div");this.element.classList.add("status-bar-xxx","inline-block");this.icon=window.document.createElement("span");this.icon.classList.add("icon-haxe");this.element.appendChild(this.icon);this.info=window.document.createElement("a");this.info.classList.add("info");this.element.appendChild(this.info);
this.meta=window.document.createElement("span");this.meta.classList.add("meta");this.element.appendChild(this.meta);d.emitter.on("hxml_select",v(this,this.changeHxml));d.emitter.on("build",function(b){var c=null,d=0;b.on("start",function(){var b=process.hrtime();c=(1E9*b[0]+b[1])/1E6;a.changeStatus("active")});b.on("message",function(a){});b.on("error",function(b){d+=1;a.changeStatus("error")});b.on("end",function(b){if(0==b){a.changeStatus("success");b=process.hrtime();b=((1E9*b[0]+b[1])/1E6-c)/
1E3;b=null==b?"null":""+b;var f=b.indexOf(".");b=b.substring(0,f)+b.substring(f,3);a.meta.textContent=b+"s"}else a.changeStatus("error"),a.meta.textContent="("+d+")"})});this.info.addEventListener("click",v(this,this.handleClickInfo),!1)};w.__name__=!0;w.getRelativePath=function(a){a=atom.project.relativizePath(a);var b=a[0].split("/");return b[b.length-1]+"/"+a[1]};w.prototype={dispose:function(){this.info.removeEventListener("click",v(this,this.handleClickInfo));null!=this.contextMenu&&this.contextMenu.dispose()},
changeHxml:function(a){null==a?(this.icon.style.display="none",this.info.textContent=""):(this.icon.style.display="inline-block",a=w.getRelativePath(a.getPath()),this.info.textContent=p.withoutExtension(a));this.meta.textContent="";this.buildContextMenu()},changeStatus:function(a){a!=this.status&&(null!=this.status&&(this.icon.classList.remove(this.status),this.info.classList.remove(this.status)),this.status=a,null!=a&&(this.icon.classList.add(a),this.info.classList.add(a)))},buildContextMenu:function(){null!=
this.contextMenu&&this.contextMenu.dispose();var a=[];null!=d.hxml&&(a.push({label:"Build",command:"xxx:build"}),a.push({type:"separator"}));for(var b=0,c=d.hxmlFiles;b<c.length;){var f=c[b];++b;null!=d.hxml&&d.hxml.getPath()==f||a.push({label:w.getRelativePath(f),command:"xxx:select-hxml"})}this.contextMenu=atom.contextMenu.add({".status-bar-xxx .info":a})},handleClickInfo:function(a){a.ctrlKey?d.build():null!=d.hxml&&atom.workspace.open(d.hxml.getPath())}};var N=0;String.__name__=!0;Array.__name__=
!0;module.exports=d;h.PATTERN=new x("^\\s*(.+):([0-9]+):\\s*(characters*|lines)\\s([0-9]+)(-([0-9]+))?\\s:\\s(.+)$","i");f.VERSION=new x("^(\\d+)\\.(\\d+)\\.(\\d+)(?:[-]([a-z0-9.-]+))?(?:[+]([a-z0-9.-]+))?$","i");f.SANITIZER=new x("[^0-9A-Za-z-]","g");d.EVENT_SELECT_HXML="hxml_select";d.EVENT_BUILD="build"})("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this);
