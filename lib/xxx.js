(function(C){function D(a,c){function b(){}b.prototype=a;var e=new b,d;for(d in c)e[d]=c[d];c.toString!==Object.prototype.toString&&(e.toString=c.toString);return e}function t(a,c){if(null==c)return null;null==c.__id__&&(c.__id__=H++);var b;null==a.hx__closures__?a.hx__closures__={}:b=a.hx__closures__[c.__id__];null==b&&(b=function(){return b.method.apply(b.scope,arguments)},b.scope=a,b.method=c,a.hx__closures__[c.__id__]=b);return b}C.xxx=C.xxx||{};var E=function(a,c){this.r=new RegExp(a,c.split("u").join(""))};
E.__name__=!0;E.prototype={match:function(a){this.r.global&&(this.r.lastIndex=0);this.r.m=this.r.exec(a);this.r.s=a;return null!=this.r.m},matched:function(a){if(null!=this.r.m&&0<=a&&a<this.r.m.length)return this.r.m[a];throw new q("EReg::matched");}};var h=function(){};h.__name__=!0;h.cca=function(a,c){var b=a.charCodeAt(c);return b!=b?void 0:b};h.substr=function(a,c,b){if(null==b)b=a.length;else if(0>b)if(0==c)b=a.length+b;else return"";return a.substr(c,b)};Math.__name__=!0;var m=function(){};
m.__name__=!0;m.string=function(a){return r.__string_rec(a,"")};m.parseInt=function(a){var c=parseInt(a,10);0!=c||120!=h.cca(a,1)&&88!=h.cca(a,1)||(c=parseInt(a));return isNaN(c)?null:c};var n=function(){};n.__name__=!0;n.startsWith=function(a,c){return a.length>=c.length?h.substr(a,0,c.length)==c:!1};n.isSpace=function(a,c){var b=h.cca(a,c);return 8<b&&14>b?!0:32==b};n.ltrim=function(a){for(var c=a.length,b=0;b<c&&n.isSpace(a,b);)++b;return 0<b?h.substr(a,b,c-b):a};n.rtrim=function(a){for(var c=
a.length,b=0;b<c&&n.isSpace(a,c-b-1);)++b;return 0<b?h.substr(a,0,c-b):a};n.trim=function(a){return n.ltrim(n.rtrim(a))};var I=require("atom").CompositeDisposable,w=function(){};w.__name__=!0;var u=require("atom").Emitter,J=require("atom").File,v=function(a){var c=this;this.id=setInterval(function(){c.run()},a)};v.__name__=!0;v.delay=function(a,c){var b=new v(c);b.run=function(){b.stop();a()};return b};v.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){}};
var p=function(a){switch(a){case ".":case "..":this.dir=a;this.file="";return}var c=a.lastIndexOf("/"),b=a.lastIndexOf("\\");c<b?(this.dir=h.substr(a,0,b),a=h.substr(a,b+1,null),this.backslash=!0):b<c?(this.dir=h.substr(a,0,c),a=h.substr(a,c+1,null)):this.dir=null;c=a.lastIndexOf(".");-1!=c?(this.ext=h.substr(a,c+1,null),this.file=h.substr(a,0,c)):(this.ext=null,this.file=a)};p.__name__=!0;p.withoutExtension=function(a){a=new p(a);a.ext=null;return a.toString()};p.extension=function(a){a=new p(a);
return null==a.ext?"":a.ext};p.prototype={toString:function(){return(null==this.dir?"":this.dir+(this.backslash?"\\":"/"))+this.file+(null==this.ext?"":"."+this.ext)}};var q=function(a){Error.call(this);this.val=a;this.message=String(a);Error.captureStackTrace&&Error.captureStackTrace(this,q)};q.__name__=!0;q.wrap=function(a){return a instanceof Error?a:new q(a)};q.__super__=Error;q.prototype=D(Error.prototype,{});var r=function(){};r.__name__=!0;r.__string_rec=function(a,c){if(null==a)return"null";
if(5<=c.length)return"<...>";var b=typeof a;"function"==b&&(a.__name__||a.__ename__)&&(b="object");switch(b){case "function":return"<function>";case "object":if(a instanceof Array){if(a.__enum__){if(2==a.length)return a[0];b=a[0]+"(";c+="\t";for(var e=2,d=a.length;e<d;)var g=e++,b=2!=g?b+(","+r.__string_rec(a[g],c)):b+r.__string_rec(a[g],c);return b+")"}b=a.length;e="[";c+="\t";for(d=0;d<b;)g=d++,e+=(0<g?",":"")+r.__string_rec(a[g],c);return e+"]"}try{e=a.toString}catch(f){return"???"}if(null!=e&&
e!=Object.toString&&"function"==typeof e&&(b=a.toString(),"[object Object]"!=b))return b;b=null;e="{\n";c+="\t";d=null!=a.hasOwnProperty;for(b in a)d&&!a.hasOwnProperty(b)||"prototype"==b||"__class__"==b||"__super__"==b||"__interfaces__"==b||"__properties__"==b||(2!=e.length&&(e+=", \n"),e+=c+b+" : "+r.__string_rec(a[b],c));c=c.substring(1);return e+("\n"+c+"}");case "string":return a;default:return String(a)}};var F=require("child_process"),G=require("fs");require("buffer");var k=function(){};k.__name__=
!0;k.parse=function(a){if(k.PATTERN.match(a)){a=new k;a.path=k.PATTERN.matched(1);a.line=m.parseInt(k.PATTERN.matched(2));switch(k.PATTERN.matched(3)){case "character":a.character=m.parseInt(k.PATTERN.matched(4));a.content=k.PATTERN.matched(7);break;case "characters":a.characters={start:m.parseInt(k.PATTERN.matched(4)),end:m.parseInt(k.PATTERN.matched(6))};a.content=k.PATTERN.matched(7);break;case "lines":a.lines={start:m.parseInt(k.PATTERN.matched(4)),end:m.parseInt(k.PATTERN.matched(6))},a.content=
k.PATTERN.matched(7)}return a}return null};var x=function(){u.call(this);this.running=!1};x.__name__=!0;x.__super__=u;x.prototype=D(u.prototype,{select:function(a){null!=this.hxml&&a==this.hxml.getPath()||this.emit("hxml_select",this.hxml=new J(a))},start:function(a){null==a&&(a=!1);var c=this;if(null==this.hxml)throw new q("no hxml file selected");var b=this.hxml.getParent().getPath(),e=[];a&&e.push("-v");e.push(this.hxml.getBaseName());this.proc=F.spawn("haxe",e,{cwd:b});this.proc.stdout.on("data",
function(a){c.emit("message",a.toString())});this.proc.stderr.on("data",function(a){c.emit("error",a.toString())});this.proc.on("exit",function(a){c.emit("end",a)});this.proc.on("message",function(a){});this.proc.on("error",function(a){});this.running=!0;this.emit("start")}});var d=C.xxx.IDE=function(){};d.__name__=!0;d.activate=function(a){d.disposables=new I;d.server=new y(atom.config.get("xxx.haxe_path"),atom.config.get("xxx.haxe_server_port"),atom.config.get("xxx.haxe_server_host"));d.server.on("error",
function(a){});d.server.on("start",function(){});d.server.on("stop",function(a){});var c=1E3*atom.config.get("xxx.haxe_server_startdelay");v.delay(function(){d.server.start()},c);d.build=new x;d.buildView=new z;var b=new A;d.build.on("start",function(){b.clear()});d.build.on("exit",function(a){});atom.commands.add("atom-workspace","haxe:start-server",function(a){d.server.start()});atom.commands.add("atom-workspace","haxe:stop-server",function(a){d.server.stop()});atom.commands.add("atom-workspace",
"haxe:build",function(a){a=d.getTreeViewFile();null!=a&&"hxml"==p.extension(a)&&d.build.select(a);d.buildView.panel.show();try{d.build.start()}catch(b){b instanceof q&&(b=b.val),atom.notifications.addWarning(b)}});var e=null;null==e&&(e=atom.project.getPaths());for(var c=[],l=0;l<e.length;){var g=e[l];++l;for(var f=0,h=G.readdirSync(g);f<h.length;){var k=h[f];++f;"."!=k.charAt(0)&&"hxml"==p.extension(k)&&c.push(""+g+"/"+k)}}d.hxmlFiles=c;if(null!=a&&null!=a.hxml){e=!1;for(l=0;l<c.length;)if(g=c[l],
++l,g==a.hxml){e=!0;break}d.build.select(e?a.hxml:c[0])}else d.build.select(c[0])};d.serialize=function(){return{hxml:null!=d.build.hxml?d.build.hxml.getPath():null}};d.deactivate=function(){d.disposables.dispose();d.server.stop()};d.provideAutoCompletion=function(){return null};d.searchHxmlFiles=function(a,c){null==a&&(a=atom.project.getPaths());for(var b=[],e=0;e<a.length;){var d=a[e];++e;for(var g=0,f=G.readdirSync(d);g<f.length;){var h=f[g];++g;"."!=h.charAt(0)&&"hxml"==p.extension(h)&&b.push(""+
d+"/"+h)}}c(b)};d.consumeStatusBar=function(a){a.addLeftTile({item:(new B).element,priority:-100})};d.getTreeViewFile=function(a){var c=atom.packages.getLoadedPackage("tree-view").serialize().selectedPath;return null==a||null!=c&&p.extension(c)==a?c:null};d.getConfig=function(a){return atom.config.get("xxx."+a)};var y=function(a,c,b,d){null==d&&(d=!0);null==b&&(b="127.0.0.1");null==a&&(a="haxe");u.call(this);this.path=a;this.port=c;this.host=b;this.verbose=d;this.running=!1};y.__name__=!0;y.__super__=
u;y.prototype=D(u.prototype,{start:function(){var a=this,c=[];this.verbose&&c.push("-v");c.push("--wait");c.push(""+this.host+":"+this.port);this.proc=F.spawn(this.path,c,{});this.proc.stdout.on("data",function(b){a.emit("message",b.toString())});this.proc.stderr.on("data",function(b){a.emit("error",b.toString())});this.proc.on("close",function(b){a.emit("stop",b)});this.proc.on("message",function(a){});this.proc.on("error",function(a){});this.running=!0;this.emit("start")},stop:function(){if(null!=
this.proc){this.proc.removeAllListeners();try{this.proc.kill()}catch(a){}this.proc=null;this.emit("stop",0)}this.running=!1}});var z=function(){var a=this;this.element=window.document.createElement("div");this.element.classList.add("xxx-build","inline-block");this.messages=window.document.createElement("ol");this.messages.classList.add("messages","scroller");this.element.appendChild(this.messages);this.panel=atom.workspace.addBottomPanel({item:this.element,visible:!1});d.build.on("start",function(c){a.clear()});
d.build.on("end",function(c){0==a.messages.children.length&&a.panel.hide()});d.build.on("message",function(c){var b=window.document.createElement("li");b.classList.add("message");b.textContent=c;a.messages.appendChild(b)});d.build.on("error",function(c){c=n.trim(c);var b=k.parse(c);if(null==b)b=window.document.createElement("li"),b.classList.add("message","error"),b.textContent=c,a.messages.appendChild(b);else{c=window.document.createElement("li");c.classList.add("message","error");var d=window.document.createElement("span");
d.classList.add("path");d.textContent=b.path;c.appendChild(d);d=window.document.createElement("span");d.classList.add("line");d.textContent=null==b.line?"null":""+b.line;c.appendChild(d);null!=b.characters&&(d=window.document.createElement("span"),d.classList.add("start"),d.textContent=m.string(b.characters.start),c.appendChild(d),d=window.document.createElement("span"),d.classList.add("end"),d.textContent=m.string(b.characters.end),c.appendChild(d));d=window.document.createElement("span");d.classList.add("content");
d.textContent=b.content;c.appendChild(d);c.onclick=function(){};a.messages.appendChild(c)}});this.element.addEventListener("click",t(this,this.handleClick),!1)};z.__name__=!0;z.__interfaces__=[w];z.prototype={clear:function(){for(;null!=this.messages.firstChild;)this.messages.removeChild(this.messages.firstChild)},dispose:function(){this.panel.destroy()},handleClick:function(a){this.panel.hide()}};var A=function(){var a=this;this.element=window.document.createElement("div");this.element.classList.add("haxe-serverlog",
"resizer");this.messages=window.document.createElement("ol");this.messages.classList.add("messages","scroller");this.element.appendChild(this.messages);this.panel=atom.workspace.addRightPanel({item:this.element,visible:!1});d.build.on("start",function(b){a.clear()});var c=!1;d.server.on("message",function(b){if(n.startsWith(b,"Completion Response ="))b=h.substr(b,19,null),window.console.debug(b);else{c&&(c=!1,a.clear());var d=0;for(b=b.split("\n");d<b.length;){var l=[b[d]];++d;if(0!=(l[0]=n.trim(l[0])).length){var g=
l[0].indexOf(" "),f=h.substr(l[0],0,g).toLowerCase();if(">"==f)f="error";else if(null==f){window.console.error("Unknown haxe build info token: "+f);atom.notifications.addWarning("Unknown haxe build info token: "+f);break}g=window.document.createElement("li");g.classList.add("message",f);g.textContent=l[0];a.messages.appendChild(g);switch(f){case "parsed":f=window.document.createElement("span");f.textContent="Parsed";g.appendChild(f);f=window.document.createElement("span");f.classList.add("link");
f.onclick=function(a){return function(b){b.ctrlKey||atom.workspace.open(h.substr(a[0],7,null))}}(l);f.textContent=h.substr(l[0],7,null);g.appendChild(f);break;case "processing":f=window.document.createElement("div");f.textContent="Processing Arguments";g.appendChild(f);f=l[0].indexOf("[")+1;l=l[0].substring(f,l[0].length-1).split(",");for(f=0;f<l.length;){var k=l[f],m=l[f+1];null==m||n.startsWith(m,"-")||(k+=" "+m,++f);m=window.document.createElement("div");m.textContent=k;m.classList.add("param");
g.appendChild(m);++f}break;case "time":g.textContent=l[0];a.element.scrollTop=a.messages.scrollHeight;c=!0;break;default:g.textContent=l[0]}}}}});atom.commands.add("atom-workspace","haxe:toggle-server-log",function(b){a.panel.isVisible()?a.panel.hide():a.panel.show()});this.element.addEventListener("click",t(this,this.handleClick),!1)};A.__name__=!0;A.__interfaces__=[w];A.prototype={clear:function(){for(;null!=this.messages.firstChild;)this.messages.removeChild(this.messages.firstChild)},dispose:function(){this.element.removeEventListener("click",
t(this,this.handleClick));this.panel.destroy()},handleClick:function(a){a.preventDefault();a.stopPropagation();this.panel.isVisible()?this.panel.hide():this.panel.show()}};var B=function(){var a=this;this.element=window.document.createElement("div");this.element.classList.add("status-bar-xxx","inline-block");this.icon=window.document.createElement("span");this.icon.classList.add("icon-haxe");this.element.appendChild(this.icon);this.info=window.document.createElement("a");this.info.classList.add("info");
this.element.appendChild(this.info);this.meta=window.document.createElement("span");this.meta.classList.add("meta");this.element.appendChild(this.meta);d.server.on("start",function(){a.icon.classList.remove("off");a.tooltip=atom.tooltips.add(a.icon,{title:d.server.host+":"+d.server.port})});d.server.on("stop",function(b){a.icon.classList.add("off");null!=a.tooltip&&a.tooltip.dispose()});d.server.on("message",function(b){a.meta.textContent=b;null!=a.tooltip&&a.tooltip.dispose()});d.server.running&&
(this.tooltip=atom.tooltips.add(this.icon,{title:d.server.host+":"+d.server.port}));var c=null;d.build.on("start",function(b){a.changeStatus("active");b=process.hrtime();c=(1E9*b[0]+b[1])/1E6});d.build.on("message",function(b){a.meta.textContent=b});d.build.on("error",function(a){});d.build.on("end",function(b){0==b?a.changeStatus("success"):a.changeStatus("error");b=process.hrtime();b=((1E9*b[0]+b[1])/1E6-c)/1E3;b=null==b?"null":""+b;var d=b.indexOf(".");a.meta.textContent=b.substring(0,d)+b.substring(d,
3)+"s"});d.build.on("hxml_select",t(this,this.changeHxml));this.changeHxml(d.build.hxml);this.info.addEventListener("click",t(this,this.handleClickInfo),!1)};B.__name__=!0;B.__interfaces__=[w];B.prototype={changeHxml:function(a){if(null==a)this.icon.style.display="none",this.info.textContent=this.meta.textContent="",null!=this.contextMenu&&this.contextMenu.dispose();else{this.icon.style.display="inline-block";a.getPath();a=atom.project.relativizePath(a.getPath());if(null!=a[0]){var c=a[0].split("/");
this.info.textContent=p.withoutExtension(c[c.length-1]+"/"+a[1])}this.meta.textContent="";this.contextMenu=atom.contextMenu.add({".status-bar-xxx .info":[{label:"Build",command:"haxe:build"}]})}},changeStatus:function(a){a!=this.status&&(null!=this.status&&(this.icon.classList.remove(this.status),this.info.classList.remove(this.status)),this.status=a,this.icon.classList.add(a),this.info.classList.add(a));this.meta.textContent=""},dispose:function(){this.info.removeEventListener("click",t(this,this.handleClickInfo));
null!=this.contextMenu&&this.contextMenu.dispose()},handleClickInfo:function(a){a.ctrlKey?d.build.start():null!=d.build.hxml&&atom.workspace.open(d.build.hxml.getPath())}};var H=0;String.__name__=!0;Array.__name__=!0;module.exports=d;k.PATTERN=new E("^\\s*(.+):([0-9]+):\\s*(characters*|lines)\\s([0-9]+)(-([0-9]+))?\\s:\\s(.+)$","i")})("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this);
